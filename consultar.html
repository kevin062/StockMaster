<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Consultar Producto | StockMaster</title>
  <link rel="icon" type="image/png" href="iconoyloginIMG/Icono.png" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>

<body class="consult-body">
  <header style="display: flex; justify-content: center; align-items: center; height: 100px; background: rgb(22, 140, 140);">
    <h1><a href="index.html" style="color: white; text-decoration: none;">StockMaster</a></h1>
  </header>

  <div class="consult-container">
    <div class="consult-card">
      <div class="consult-header-icon">
        <i class="fas fa-search"></i>
      </div>

      <h2 class="consult-title">Consultar Producto</h2>
      <p class="consult-subtitle">
        Usa los filtros disponibles para encontrar productos f√°cilmente en el inventario.
        Puedes buscar por c√≥digo, nombre, categor√≠a o cualquier otro criterio.
      </p>

      <form id="formConsultar" class="consult-form">
        <div class="consult-form-row">
          <div class="consult-form-group">
            <label for="codigo" class="consult-form-label">
              <i class="fas fa-barcode me-2"></i>C√≥digo o Referencia
            </label>
            <input type="text" id="codigo" name="codigo" class="consult-form-input" placeholder="Ej: INV-1054" />
          </div>

          <div class="consult-form-group">
            <label for="nombre" class="consult-form-label">
              <i class="fas fa-tag me-2"></i>Nombre del Producto
            </label>
            <input type="text" id="nombre" name="nombre" class="consult-form-input" placeholder="Ej: Arroz Diana 500g" />
          </div>
        </div>

        <div class="consult-form-row">
          <div class="consult-form-group">
            <label for="categoria" class="consult-form-label">
              <i class="fas fa-list me-2"></i>Categor√≠a
            </label>
            <select id="categoria" name="categoria" class="consult-form-select">
              <option value="">-- Selecciona una categor√≠a --</option>
              <option value="granos">üåæ Granos</option>
              <option value="lacteos">ü•õ L√°cteos</option>
              <option value="bebidas">ü•§ Bebidas</option>
              <option value="aseo">üßº Aseo personal</option>
              <option value="enlatados">ü•´ Enlatados</option>
            </select>
          </div>

          <div class="consult-form-group">
            <label for="proveedor" class="consult-form-label">
              <i class="fas fa-truck me-2"></i>Proveedor
            </label>
            <input type="text" id="proveedor" name="proveedor" class="consult-form-input" placeholder="Ej: Alpina, Postob√≥n, Colanta..." />
          </div>
        </div>

        <div class="consult-form-group">
          <label class="consult-form-label">
            <i class="fas fa-dollar-sign me-2"></i>Rango de Precio (COP)
          </label>
          <div class="consult-precio-range">
            <input type="number" id="precio-min" name="precio-min" class="consult-form-input consult-precio-input" placeholder="Precio m√≠nimo" min="0" step="100" />
            <span class="consult-precio-separator">&mdash;</span>
            <input type="number" id="precio-max" name="precio-max" class="consult-form-input consult-precio-input" placeholder="Precio m√°ximo" min="0" step="100" />
          </div>
        </div>

        <div class="consult-form-group">
          <label for="estado" class="consult-form-label">
            <i class="fas fa-info-circle me-2"></i>Estado del Producto
          </label>
          <select id="estado" name="estado" class="consult-form-select">
            <option value="">-- Selecciona un estado --</option>
            <option value="disponible">‚úÖ Disponible</option>
            <option value="agotado">‚ùå Agotado</option>
            <option value="en_reposicion">üîÑ En reposici√≥n</option>
          </select>
        </div>

        <div class="consult-form-actions">
          <button type="submit" class="consult-btn-search">
            <i class="fas fa-search me-2"></i> Consultar Producto
          </button>
          <button type="reset" class="consult-btn-reset">
            <i class="fas fa-redo me-2"></i> Limpiar Filtros
          </button>
        </div>
      </form>

      <div id="resultadoConsulta" class="consult-results mt-4">
        <p class="text-muted text-center">üîç Los resultados aparecer√°n aqu√≠...</p>
      </div>

      <div class="consult-info-box mt-3">
        <i class="fas fa-lightbulb me-2"></i>
        <strong>Consejo:</strong> Deja los campos vac√≠os que no necesites.
        El sistema buscar√° productos que coincidan con los filtros que hayas completado.
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("formConsultar");
      const resultado = document.getElementById("resultadoConsulta");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const codigo = document.getElementById("codigo").value.trim();
        const nombre = document.getElementById("nombre").value.trim();
        const categoria = document.getElementById("categoria").value.trim();
        const proveedor = document.getElementById("proveedor").value.trim();
        const precioMin = document.getElementById("precio-min").value.trim();
        const precioMax = document.getElementById("precio-max").value.trim();
        const estado = document.getElementById("estado").value.trim();

        if (!codigo && !nombre && !categoria && !proveedor && !precioMin && !precioMax && !estado) {
          resultado.innerHTML = `
            <div class="alert alert-warning text-center" role="alert">
              ‚ö†Ô∏è Ingresa al menos un filtro para realizar la b√∫squeda.
            </div>`;
          return;
        }

        try {
          const params = new URLSearchParams({
            codigo, nombre, categoria, proveedor,
            "precio-min": precioMin, "precio-max": precioMax, estado
          });

          const response = await fetch(`procesar_consulta.php?${params.toString()}`);
          if (!response.ok) throw new Error("Error en la conexi√≥n con el servidor");

          const data = await response.json();

          if (data.status === "success" && data.data.length > 0) {
            resultado.innerHTML = data.data.map(producto => `
              <div class="card mt-3 shadow">
                <div class="card-header bg-info text-white">
                  <h5 class="mb-0"><i class="fas fa-box me-2"></i>${producto.nombre}</h5>
                </div>
                <div class="card-body">
                  <table class="table table-bordered table-striped">
                    <tbody>
                      <tr><th>ID</th><td>${producto.id}</td></tr>
                      <tr><th>C√≥digo</th><td>${producto.codigo}</td></tr>
                      <tr><th>Nombre</th><td>${producto.nombre}</td></tr>
                      <tr><th>Descripci√≥n</th><td>${producto.descripcion || "‚Äî"}</td></tr>
                      <tr><th>Categor√≠a</th><td>${producto.categoria || "‚Äî"}</td></tr>
                      <tr><th>Proveedor</th><td>${producto.proveedor || "‚Äî"}</td></tr>
                      <tr><th>Precio</th><td>$${parseFloat(producto.precio).toLocaleString("es-CO")}</td></tr>
                      <tr><th>Stock</th><td>${producto.stock}</td></tr>
                      <tr><th>Estado</th><td>${producto.estado}</td></tr>
                      <tr><th>Fecha de Ingreso</th><td>${producto.fecha_ingreso || "‚Äî"}</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            `).join("");
          } else {
            resultado.innerHTML = `
              <div class="alert alert-danger text-center" role="alert">
                ‚ùå No se encontr√≥ ning√∫n producto con los datos ingresados.
              </div>`;
          }
        } catch (error) {
          resultado.innerHTML = `
            <div class="alert alert-danger text-center" role="alert">
              ‚ö†Ô∏è Error: ${error.message}
            </div>`;
        }
      });
    });
  </script>
</body>
</html>
